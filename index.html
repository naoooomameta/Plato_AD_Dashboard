<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åºƒå‘Šé‹ç”¨ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>  
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Noto Sans JP',sans-serif; background:#f4f5f7; display:flex; min-height:100vh; color:#1a1a2e; }

  /* ===== SIDEBAR ===== */
  .sidebar {
    width:220px; background:linear-gradient(160deg,#7c3aed 0%,#6d28d9 60%,#5b21b6 100%);
    min-height:100vh; padding:28px 16px; display:flex; flex-direction:column; gap:4px; flex-shrink:0;
    position:sticky; top:0; height:100vh;
  }
  .sidebar-logo {
    display:flex; align-items:center; gap:10px; color:white; font-size:15px; font-weight:700;
    padding:8px 12px 24px; border-bottom:1px solid rgba(255,255,255,0.15); margin-bottom:8px;
  }
  .sidebar-logo .icon {
    width:30px; height:30px; background:rgba(255,255,255,0.2); border-radius:8px;
    display:flex; align-items:center; justify-content:center; font-size:16px;
  }
  .sidebar-item {
    display:flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px;
    color:rgba(255,255,255,0.75); font-size:14px; font-weight:500; cursor:pointer; transition:all 0.15s;
  }
  .sidebar-item.active { background:rgba(255,255,255,0.2); color:white; }
  .sidebar-item:hover:not(.active) { background:rgba(255,255,255,0.1); color:white; }

  /* ===== MAIN ===== */
  .main { flex:1; padding:28px 32px; overflow-x:hidden; overflow-y:auto; }
  .page { display:none; }
  .page.active { display:block; }

  /* ===== TOPBAR ===== */
  .topbar { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
  .topbar-left { display:flex; align-items:center; gap:14px; }
  .topbar-left h1 { font-size:22px; font-weight:700; color:#1a1a2e; }
  .btn {
    display:flex; align-items:center; gap:6px; padding:8px 16px; border-radius:10px;
    font-size:13px; font-weight:600; cursor:pointer; border:none; transition:all 0.15s;
    font-family:'Noto Sans JP',sans-serif;
  }
  .btn-primary { background:#7c3aed; color:white; }
  .btn-primary:hover { background:#6d28d9; }
  .btn-outline { background:white; color:#6b7280; border:1px solid #e5e7eb; }
  .btn-outline:hover { border-color:#7c3aed; color:#7c3aed; }

  .period-tabs { display:flex; background:white; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }
  .period-tab {
    padding:7px 16px; font-size:13px; font-weight:500; cursor:pointer; color:#6b7280;
    transition:all 0.15s; border:none; background:transparent; font-family:'Noto Sans JP',sans-serif;
  }
  .period-tab.active { background:#7c3aed; color:white; }
  .period-tab:hover:not(.active) { color:#7c3aed; }

  /* ===== CHIPS ===== */
  .month-filters { display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; }
  .chip {
    padding:5px 13px; border-radius:20px; font-size:12px; font-weight:500;
    cursor:pointer; transition:all 0.15s; border:1.5px solid transparent; font-family:'Noto Sans JP',sans-serif;
  }
  .chip-all { background:#ede9fe; color:#7c3aed; border-color:#7c3aed; }
  .chip-month { background:white; color:#6b7280; border-color:#e5e7eb; }
  .chip-month:hover,.chip-month.active { border-color:#7c3aed; color:#7c3aed; background:#faf5ff; }

  /* ===== CARDS ===== */
  .card { background:white; border-radius:16px; padding:20px 22px; border:1px solid #f0f0f5; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
  .card-hero {
    background:linear-gradient(135deg,#7c3aed 0%,#9333ea 100%); color:white; border-radius:16px;
    padding:24px 28px; display:flex; flex-direction:column; justify-content:space-between;
    min-height:130px; position:relative; overflow:hidden; border:none; box-shadow:0 4px 20px rgba(124,58,237,0.3);
  }
  .card-hero::after {
    content:'Â¥'; position:absolute; right:28px; top:50%; transform:translateY(-50%);
    width:56px; height:56px; background:rgba(255,255,255,0.2); border-radius:50%;
    display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:700;
    line-height:56px; text-align:center;
  }
  .hero-label { font-size:13px; font-weight:500; opacity:0.85; margin-bottom:10px; }
  .hero-value { font-size:34px; font-weight:700; letter-spacing:-0.5px; }
  .card-label { font-size:11.5px; color:#9ca3af; font-weight:500; margin-bottom:10px; }
  .card-value { font-size:26px; font-weight:700; color:#111827; letter-spacing:-0.3px; }
  .card-value-sm { font-size:20px; font-weight:700; color:#111827; letter-spacing:-0.3px; }
  .card-sub { font-size:11.5px; color:#9ca3af; margin-top:4px; }
  .card-row { display:flex; justify-content:space-between; align-items:flex-start; }
  .card-icon { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
  .icon-green  { background:#dcfce7; }
  .icon-purple { background:#ede9fe; }
  .icon-blue   { background:#dbeafe; }
  .icon-orange { background:#ffedd5; }
  .icon-red    { background:#fee2e2; }
  .icon-yellow { background:#fef3c7; }
  .icon-teal   { background:#ccfbf1; }
  .icon-gray   { background:#f3f4f6; }

  /* ===== GRIDS ===== */
  .g  { display:grid; gap:16px; margin-bottom:16px; }
  .g3 { grid-template-columns:1.6fr 1fr 1fr; }
  .g4 { grid-template-columns:repeat(4,1fr); }
  .g3e{ grid-template-columns:repeat(3,1fr); }
  .g2 { grid-template-columns:repeat(2,1fr); }
  .g2-1{ grid-template-columns:2fr 1fr; }
  .g1-2{ grid-template-columns:1fr 2fr; }

  /* ===== CHARTS ===== */
  .chart-wrap { background:white; border-radius:16px; padding:20px 22px; border:1px solid #f0f0f5; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
  .chart-hd { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
  .chart-title { font-size:13.5px; font-weight:700; color:#111827; }
  .chart-sub2 { font-size:11px; color:#9ca3af; margin-top:2px; }
  .legend-row { display:flex; gap:14px; }
  .legend-item { display:flex; align-items:center; gap:5px; font-size:11px; color:#6b7280; }
  .ldot { width:8px; height:8px; border-radius:50%; }

  /* ===== TABLE ===== */
  .table-wrap { background:white; border-radius:16px; border:1px solid #f0f0f5; box-shadow:0 1px 3px rgba(0,0,0,0.04); overflow:hidden; margin-bottom:16px; }
  .table-hd { padding:18px 22px 14px; border-bottom:1px solid #f3f4f6; display:flex; justify-content:space-between; align-items:center; }
  table { width:100%; border-collapse:collapse; font-size:12.5px; }
  thead th {
    padding:9px 14px; text-align:right; font-size:10.5px; font-weight:600; color:#9ca3af;
    background:#fafafa; border-bottom:1px solid #f3f4f6; white-space:nowrap;
    position:sticky; top:0; z-index:1;
  }
  thead th:first-child { text-align:left; }
  tbody tr { border-bottom:1px solid #f9fafb; transition:background 0.1s; }
  tbody tr:hover { background:#faf5ff; }
  tbody tr:last-child { border-bottom:none; }
  td { padding:10px 14px; text-align:right; white-space:nowrap; color:#374151; font-variant-numeric:tabular-nums; }
  td:first-child { text-align:left; font-weight:700; color:#7c3aed; font-size:13px; }
  td.cost  { font-weight:600; color:#111827; }
  td.cpa-low  { color:#16a34a; font-weight:600; }
  td.cpa-mid  { color:#2563eb; font-weight:600; }
  td.cpa-high { color:#ea580c; font-weight:600; }
  td.muted { color:#d1d5db; }
  td.pos   { color:#16a34a; }
  td.neg   { color:#dc2626; }

  /* ===== SECTION TITLE ===== */
  .section-title { font-size:13px; font-weight:700; color:#6b7280; letter-spacing:0.5px; text-transform:uppercase; margin:24px 0 12px; }

  /* ===== BADGE ===== */
  .badge { display:inline-block; padding:2px 8px; border-radius:20px; font-size:11px; font-weight:600; }
  .badge-green  { background:#dcfce7; color:#16a34a; }
  .badge-red    { background:#fee2e2; color:#dc2626; }
  .badge-blue   { background:#dbeafe; color:#2563eb; }
  .badge-purple { background:#ede9fe; color:#7c3aed; }
  .badge-gray   { background:#f3f4f6; color:#6b7280; }

  /* ===== SETTINGS ===== */
  .settings-group { background:white; border-radius:16px; border:1px solid #f0f0f5; overflow:hidden; margin-bottom:16px; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
  .settings-group-title { padding:16px 22px; font-size:13px; font-weight:700; color:#374151; border-bottom:1px solid #f3f4f6; background:#fafafa; }
  .settings-row { display:flex; align-items:center; justify-content:space-between; padding:14px 22px; border-bottom:1px solid #f9fafb; }
  .settings-row:last-child { border-bottom:none; }
  .settings-label { font-size:13.5px; color:#374151; font-weight:500; }
  .settings-desc  { font-size:11.5px; color:#9ca3af; margin-top:2px; }
  .toggle { width:40px; height:22px; background:#e5e7eb; border-radius:11px; position:relative; cursor:pointer; transition:background 0.2s; flex-shrink:0; }
  .toggle.on { background:#7c3aed; }
  .toggle::after { content:''; position:absolute; width:16px; height:16px; background:white; border-radius:50%; top:3px; left:3px; transition:transform 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
  .toggle.on::after { transform:translateX(18px); }
  .select-input {
    padding:6px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;
    color:#374151; background:white; cursor:pointer; font-family:'Noto Sans JP',sans-serif;
  }
  .text-input {
    padding:6px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:13px;
    color:#374151; background:white; font-family:'Noto Sans JP',sans-serif; width:200px;
    outline:none; transition:border-color 0.15s;
  }
  .text-input:focus { border-color:#7c3aed; }

  /* ===== PROGRESS BAR ===== */
  .progress-bar { height:6px; background:#f3f4f6; border-radius:3px; overflow:hidden; margin-top:8px; }
  .progress-fill { height:100%; border-radius:3px; transition:width 0.6s ease; }

  /* ===== REPORT CARD ===== */
  .report-row { display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px solid #f3f4f6; }
  .report-row:last-child { border-bottom:none; }

  @keyframes fadeUp { from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);} }
  .card,.card-hero,.chart-wrap,.table-wrap,.settings-group { animation:fadeUp 0.3s ease both; }

  /* Loading / Error banners */
  #loading-banner {
    position:fixed; inset:0; background:rgba(244,245,247,0.92); z-index:1000;
    display:none; flex-direction:column; align-items:center; justify-content:center; gap:16px;
  }
  .spinner {
    width:40px; height:40px; border:3px solid #e5e7eb;
    border-top-color:#7c3aed; border-radius:50%; animation:spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform:rotate(360deg); } }
  #loading-banner p { font-size:14px; color:#6b7280; font-weight:500; }
  #error-banner {
    display:none; position:fixed; top:16px; left:50%; transform:translateX(-50%);
    background:#fee2e2; color:#dc2626; border:1px solid #fca5a5;
    padding:10px 20px; border-radius:10px; font-size:13px; z-index:1001;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  #last-updated { font-size:11px; color:#9ca3af; }
  .reload-btn { background:none; border:1px solid rgba(255,255,255,0.3); color:rgba(255,255,255,0.8); padding:5px 10px; border-radius:6px; cursor:pointer; font-size:12px; font-family:'Noto Sans JP',sans-serif; margin-top:8px; transition:all 0.15s; }
  .reload-btn:hover { background:rgba(255,255,255,0.15); color:white; }

  /* ===== MOBILE HEADER ===== */
  .mobile-header {
    display:none; position:fixed; top:0; left:0; right:0; z-index:200;
    background:linear-gradient(90deg,#7c3aed,#9333ea);
    padding:0 16px; height:56px;
    align-items:center; justify-content:space-between;
    box-shadow:0 2px 8px rgba(124,58,237,0.3);
  }
  .mobile-header-title { color:white; font-size:16px; font-weight:700; }
  .hamburger {
    width:36px; height:36px; background:rgba(255,255,255,0.15); border:none; border-radius:8px;
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:5px;
    cursor:pointer; padding:0;
  }
  .hamburger span { display:block; width:18px; height:2px; background:white; border-radius:2px; transition:all 0.2s; }

  /* ===== BOTTOM NAV (ã‚¹ãƒãƒ›ç”¨) ===== */
  .bottom-nav {
    display:none; position:fixed; bottom:0; left:0; right:0; z-index:200;
    background:white; border-top:1px solid #e5e7eb;
    padding:8px 0 max(8px, env(safe-area-inset-bottom));
    box-shadow:0 -4px 12px rgba(0,0,0,0.08);
  }
  .bottom-nav-inner { display:flex; justify-content:space-around; }
  .bnav-item {
    display:flex; flex-direction:column; align-items:center; gap:3px;
    padding:4px 12px; border-radius:8px; cursor:pointer;
    color:#9ca3af; font-size:10px; font-weight:500; transition:all 0.15s;
    border:none; background:transparent; font-family:'Noto Sans JP',sans-serif;
    min-width:56px;
  }
  .bnav-item .bnav-icon { font-size:20px; line-height:1; }
  .bnav-item.active { color:#7c3aed; }
  .bnav-item.active .bnav-icon { transform:scale(1.1); }

  /* ===== SIDEBAR OVERLAY (ã‚¹ãƒãƒ›ç”¨) ===== */
  .sidebar-overlay {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:150;
  }
  .sidebar-overlay.open { display:block; }

  /* ===== RESPONSIVE BREAKPOINTS ===== */
  @media (max-width: 768px) {
    body { display:block; }

    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’ãƒ‰ãƒ­ãƒ¯ãƒ¼åŒ– */
    .sidebar {
      position:fixed; top:0; left:-240px; width:240px; height:100vh;
      z-index:160; transition:left 0.25s ease; box-shadow:4px 0 20px rgba(0,0,0,0.15);
    }
    .sidebar.open { left:0; }

    /* ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º */
    .mobile-header { display:flex; }

    /* ãƒœãƒˆãƒ ãƒŠãƒ“è¡¨ç¤º */
    .bottom-nav { display:block; }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª¿æ•´ */
    .main {
      padding:72px 16px 80px;
      min-height:100vh;
    }

    /* ãƒˆãƒƒãƒ—ãƒãƒ¼èª¿æ•´ */
    .topbar { flex-wrap:wrap; gap:10px; margin-bottom:14px; }
    .topbar-left h1 { font-size:18px; }
    .period-tabs { width:100%; }
    .period-tab { flex:1; padding:7px 8px; font-size:12px; }

    /* ã‚°ãƒªãƒƒãƒ‰ â†’ 1ã€œ2åˆ— */
    .g3  { grid-template-columns:1fr; }
    .g4  { grid-template-columns:repeat(2,1fr); }
    .g3e { grid-template-columns:repeat(2,1fr); }
    .g2  { grid-template-columns:1fr; }
    .g2-1{ grid-template-columns:1fr; }
    .g1-2{ grid-template-columns:1fr; }

    /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ */
    .hero-value { font-size:26px; }
    .card-value { font-size:20px; }

    /* æœˆãƒãƒƒãƒ— */
    .month-filters { gap:6px; }
    .chip { padding:4px 10px; font-size:11px; }

    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
    .table-wrap { border-radius:12px; }

    /* è¨­å®šãƒšãƒ¼ã‚¸ */
    .settings-row { flex-wrap:wrap; gap:10px; }
    .text-input { width:100%; }

    /* ãƒãƒ£ãƒ¼ãƒˆé«˜ã•ç¸®å° */
    .chart-wrap { padding:14px 14px; }
  }

  @media (max-width: 480px) {
    .g4 { grid-template-columns:repeat(2,1fr); }
    .g3e { grid-template-columns:1fr 1fr; }
    .topbar-left { flex-wrap:wrap; }
    .hero-value { font-size:22px; }
  }
</style>
</head>
<body>

<!-- Mobile Header -->
<div class="mobile-header">
  <button class="hamburger" onclick="toggleSidebar()" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
    <span></span><span></span><span></span>
  </button>
  <div class="mobile-header-title" id="mobilePageTitle">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
  <button class="reload-btn" style="margin-top:0;font-size:11px;" onclick="reloadData()">ğŸ”„</button>
</div>

<!-- Sidebar overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="icon">ğŸ“Š</div>åºƒå‘Šç®¡ç†
  </div>
  <div class="sidebar-item active" onclick="showPage('dashboard',this)">ğŸ“ˆ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
  <div class="sidebar-item" onclick="showPage('cost',this)">ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ</div>
  <div class="sidebar-item" onclick="showPage('cv',this)">ğŸ‘¥ CV è©³ç´°</div>
  <div class="sidebar-item" onclick="showPage('report',this)">ğŸ“… æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</div>
  <div class="sidebar-item" onclick="showPage('settings',this)">âš™ï¸ è¨­å®š</div>
  <div style="height:1px;background:rgba(255,255,255,0.15);margin:8px 0;"></div>
  <div class="sidebar-item" onclick="showPage('weekly',this)">ğŸ“Š é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</div>
  <div class="sidebar-item" onclick="showPage('biweekly',this)">ğŸ¯ æ”¹å–„ãƒ—ãƒ©ãƒ³</div>
  <div style="margin-top:auto;padding:16px 12px 4px;border-top:1px solid rgba(255,255,255,0.15);">
    <div id="last-updated" style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:6px;">æœªæ¥ç¶š</div>
    <button class="reload-btn" onclick="reloadData()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿å†å–å¾—</button>
  </div>
</aside>

<main class="main">

<!-- ==================== PAGE: DASHBOARD ==================== -->
<div id="page-dashboard" class="page active">
  <div class="topbar">
    <div class="topbar-left">
      <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <button class="btn btn-primary" onclick="render()">ğŸ”„ æ›´æ–°</button>
    </div>
    <div class="period-tabs">
      <button class="period-tab" onclick="filterPeriod('all',this)">å…¨æœŸé–“</button>
      <button class="period-tab" onclick="filterPeriod('2024',this)">2024</button>
      <button class="period-tab active" onclick="filterPeriod('2025',this)">2025</button>
      <button class="period-tab" onclick="filterPeriod('2026',this)">2026</button>
    </div>
  </div>
  <div class="month-filters" id="monthChips"></div>

  <div class="g g3">
    <div class="card-hero">
      <div class="hero-label">ç´¯è¨ˆ åºƒå‘Šè²» (COST)</div>
      <div class="hero-value" id="totalCost">â€”</div>
    </div>
    <div class="card">
      <div class="card-row">
        <div><div class="card-label">æœ€æ–°æœˆ COST</div><div class="card-value" id="latestCost">â€”</div><div class="card-sub" id="latestMonth">â€”</div></div>
        <div class="card-icon icon-purple">ğŸ’¸</div>
      </div>
    </div>
    <div class="card">
      <div class="card-row">
        <div><div class="card-label">æœ€æ–°æœˆ é¢è«‡CPA</div><div class="card-value" id="latestMeetCpa">â€”</div><div class="card-sub" id="latestMeetN">â€”</div></div>
        <div class="card-icon icon-blue">ğŸ¤</div>
      </div>
    </div>
  </div>

  <div class="g g4">
    <div class="card"><div class="card-row"><div><div class="card-label">é¢è«‡æ•° åˆè¨ˆ</div><div class="card-value" id="totalMeet">â€”</div></div><div class="card-icon icon-blue">ğŸ‘¥</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">ä½“é¨“æ•° åˆè¨ˆ</div><div class="card-value" id="totalExp">â€”</div></div><div class="card-icon icon-teal">âœ¨</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">å¥‘ç´„æ•° åˆè¨ˆ</div><div class="card-value" id="totalCont">â€”</div></div><div class="card-icon icon-green">âœ…</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">æœ€è‰¯ å¥‘ç´„CPA</div><div class="card-value" id="bestCpa">â€”</div><div class="card-sub" id="bestCpaMonth">â€”</div></div><div class="card-icon icon-yellow">ğŸ†</div></div></div>
  </div>

  <div class="g g3e">
    <div class="card"><div class="card-row"><div><div class="card-label">é¢è«‡äºˆç´„CPA å¹³å‡</div><div class="card-value" id="avgApptCpa">â€”</div></div><div class="card-icon icon-purple">ğŸ“…</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">ä½“é¨“CPA å¹³å‡</div><div class="card-value" id="avgExpCpa">â€”</div></div><div class="card-icon icon-orange">ğŸŒŸ</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">å¥‘ç´„CPA å¹³å‡</div><div class="card-value" id="avgContCpa">â€”</div></div><div class="card-icon icon-red">ğŸ“</div></div></div>
  </div>

  <div class="g g2-1">
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">æœˆæ¬¡ã‚³ã‚¹ãƒˆæ¨ç§»</div><div class="chart-sub2">åºƒå‘Šè²»ç”¨ã®æœˆæ¬¡å¤‰å‹•</div></div></div>
      <div style="position:relative;height:200px;"><canvas id="costChart"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd">
        <div><div class="chart-title">CV æ•°æ¨ç§»</div><div class="chart-sub2">é¢è«‡ãƒ»ä½“é¨“ãƒ»å¥‘ç´„</div></div>
        <div class="legend-row">
          <div class="legend-item"><div class="ldot" style="background:#7c3aed"></div>é¢è«‡</div>
          <div class="legend-item"><div class="ldot" style="background:#06b6d4"></div>ä½“é¨“</div>
          <div class="legend-item"><div class="ldot" style="background:#10b981"></div>å¥‘ç´„</div>
        </div>
      </div>
      <div style="position:relative;height:200px;"><canvas id="cvChart"></canvas></div>
    </div>
  </div>

  <div class="g g3e">
    <div class="chart-wrap"><div class="chart-hd"><div><div class="chart-title">é¢è«‡CPA æ¨ç§»</div><div class="chart-sub2">æœˆåˆ¥ç²å¾—å˜ä¾¡</div></div></div><div style="position:relative;height:160px;"><canvas id="cpa1"></canvas></div></div>
    <div class="chart-wrap"><div class="chart-hd"><div><div class="chart-title">ä½“é¨“CPA æ¨ç§»</div><div class="chart-sub2">æœˆåˆ¥ç²å¾—å˜ä¾¡</div></div></div><div style="position:relative;height:160px;"><canvas id="cpa2"></canvas></div></div>
    <div class="chart-wrap"><div class="chart-hd"><div><div class="chart-title">å¥‘ç´„CPA æ¨ç§»</div><div class="chart-sub2">æœˆåˆ¥ç²å¾—å˜ä¾¡</div></div></div><div style="position:relative;height:160px;"><canvas id="cpa3"></canvas></div></div>
  </div>

  <div class="table-wrap">
    <div class="table-hd"><div><div class="chart-title">æœˆæ¬¡ è©³ç´°ãƒ‡ãƒ¼ã‚¿</div><div class="chart-sub2">æœŸé–“å†…ã®å…¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div></div></div>
    <div style="overflow-x:auto;overflow-y:auto;max-height:320px;">
      <table>
        <thead><tr>
          <th>Month</th><th>Cost</th><th>é¢è«‡äºˆç´„æ•°</th><th>é¢è«‡äºˆç´„CPA</th>
          <th>é¢è«‡æ•°</th><th>é¢è«‡CPA</th><th>ä½“é¨“æ•°</th><th>ä½“é¨“CPA</th>
          <th>å¥‘ç´„æ•°</th><th>å¥‘ç´„CPA</th><th>å‰å¹´æ¯” å¥‘ç´„æ•°</th><th>å‰å¹´æ¯” CPA</th>
        </tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ==================== PAGE: COST ==================== -->
<div id="page-cost" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>ã‚³ã‚¹ãƒˆåˆ†æ</h1></div>
    <div class="period-tabs">
      <button class="period-tab" onclick="filterPeriodCost('all',this)">å…¨æœŸé–“</button>
      <button class="period-tab" onclick="filterPeriodCost('2024',this)">2024</button>
      <button class="period-tab active" onclick="filterPeriodCost('2025',this)">2025</button>
      <button class="period-tab" onclick="filterPeriodCost('2026',this)">2026</button>
    </div>
  </div>

  <div class="g g4">
    <div class="card"><div class="card-row"><div><div class="card-label">æœŸé–“åˆè¨ˆã‚³ã‚¹ãƒˆ</div><div class="card-value" id="c-total">â€”</div></div><div class="card-icon icon-purple">ğŸ’°</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">æœˆå¹³å‡ã‚³ã‚¹ãƒˆ</div><div class="card-value" id="c-avg">â€”</div></div><div class="card-icon icon-blue">ğŸ“Š</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">æœ€é«˜ã‚³ã‚¹ãƒˆæœˆ</div><div class="card-value" id="c-max">â€”</div><div class="card-sub" id="c-max-m">â€”</div></div><div class="card-icon icon-red">ğŸ“ˆ</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">æœ€ä½ã‚³ã‚¹ãƒˆæœˆ</div><div class="card-value" id="c-min">â€”</div><div class="card-sub" id="c-min-m">â€”</div></div><div class="card-icon icon-green">ğŸ“‰</div></div></div>
  </div>

  <div class="g g2-1">
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">æœˆæ¬¡ã‚³ã‚¹ãƒˆæ¨ç§»ï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰</div><div class="chart-sub2">é«˜ã‚³ã‚¹ãƒˆæœˆã¯ã‚ªãƒ¬ãƒ³ã‚¸ã§è¡¨ç¤º</div></div></div>
      <div style="position:relative;height:240px;"><canvas id="costBar2"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">ã‚³ã‚¹ãƒˆåˆ†å¸ƒ</div><div class="chart-sub2">é‡‘é¡å¸¯åˆ¥ã®æœˆæ•°</div></div></div>
      <div style="position:relative;height:240px;"><canvas id="costDist"></canvas></div>
    </div>
  </div>

  <div class="chart-wrap" style="margin-bottom:16px;">
    <div class="chart-hd"><div><div class="chart-title">ã‚³ã‚¹ãƒˆæ¨ç§»ï¼ˆæŠ˜ã‚Œç·šï¼‰</div><div class="chart-sub2">æœˆæ¬¡å¤‰å‹•ãƒˆãƒ¬ãƒ³ãƒ‰</div></div></div>
    <div style="position:relative;height:160px;"><canvas id="costLine"></canvas></div>
  </div>

  <div class="table-wrap">
    <div class="table-hd"><div><div class="chart-title">æœˆåˆ¥ã‚³ã‚¹ãƒˆè©³ç´°</div></div></div>
    <div style="overflow-x:auto;overflow-y:auto;max-height:300px;">
      <table>
        <thead><tr><th>Month</th><th>Cost</th><th>å‰æœˆæ¯”</th><th>æœˆå¹³å‡ã¨ã®å·®</th><th>è©•ä¾¡</th></tr></thead>
        <tbody id="costTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ==================== PAGE: CV ==================== -->
<div id="page-cv" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>CV è©³ç´°</h1></div>
    <div class="period-tabs">
      <button class="period-tab" onclick="filterPeriodCv('all',this)">å…¨æœŸé–“</button>
      <button class="period-tab" onclick="filterPeriodCv('2024',this)">2024</button>
      <button class="period-tab active" onclick="filterPeriodCv('2025',this)">2025</button>
      <button class="period-tab" onclick="filterPeriodCv('2026',this)">2026</button>
    </div>
  </div>

  <div class="g g3e">
    <div class="card">
      <div class="card-row"><div><div class="card-label">é¢è«‡æ•° åˆè¨ˆ</div><div class="card-value" id="cv-meet">â€”</div></div><div class="card-icon icon-blue">ğŸ‘¥</div></div>
      <div class="progress-bar" style="margin-top:12px;"><div class="progress-fill" id="cv-meet-bar" style="background:#7c3aed;width:0%"></div></div>
    </div>
    <div class="card">
      <div class="card-row"><div><div class="card-label">ä½“é¨“æ•° åˆè¨ˆ</div><div class="card-value" id="cv-exp">â€”</div></div><div class="card-icon icon-teal">âœ¨</div></div>
      <div class="progress-bar" style="margin-top:12px;"><div class="progress-fill" id="cv-exp-bar" style="background:#06b6d4;width:0%"></div></div>
    </div>
    <div class="card">
      <div class="card-row"><div><div class="card-label">å¥‘ç´„æ•° åˆè¨ˆ</div><div class="card-value" id="cv-cont">â€”</div></div><div class="card-icon icon-green">âœ…</div></div>
      <div class="progress-bar" style="margin-top:12px;"><div class="progress-fill" id="cv-cont-bar" style="background:#10b981;width:0%"></div></div>
    </div>
  </div>

  <div class="g g3e">
    <div class="card"><div class="card-row"><div><div class="card-label">é¢è«‡â†’ä½“é¨“ è»¢æ›ç‡</div><div class="card-value" id="cv-r1">â€”</div></div><div class="card-icon icon-orange">ğŸ”„</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">ä½“é¨“â†’å¥‘ç´„ è»¢æ›ç‡</div><div class="card-value" id="cv-r2">â€”</div></div><div class="card-icon icon-yellow">ğŸ¯</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">é¢è«‡â†’å¥‘ç´„ è»¢æ›ç‡</div><div class="card-value" id="cv-r3">â€”</div></div><div class="card-icon icon-green">ğŸ†</div></div></div>
  </div>

  <div class="g g2">
    <div class="chart-wrap">
      <div class="chart-hd">
        <div><div class="chart-title">CV æ•° æœˆæ¬¡æ¨ç§»</div><div class="chart-sub2">é¢è«‡ãƒ»ä½“é¨“ãƒ»å¥‘ç´„ã®æ¨ç§»</div></div>
        <div class="legend-row">
          <div class="legend-item"><div class="ldot" style="background:#7c3aed"></div>é¢è«‡</div>
          <div class="legend-item"><div class="ldot" style="background:#06b6d4"></div>ä½“é¨“</div>
          <div class="legend-item"><div class="ldot" style="background:#10b981"></div>å¥‘ç´„</div>
        </div>
      </div>
      <div style="position:relative;height:220px;"><canvas id="cvLine"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">CV ãƒ•ã‚¡ãƒãƒ«</div><div class="chart-sub2">é¢è«‡â†’ä½“é¨“â†’å¥‘ç´„</div></div></div>
      <div style="position:relative;height:220px;"><canvas id="cvFunnel"></canvas></div>
    </div>
  </div>

  <div class="g g2">
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">é¢è«‡CPA vs å¥‘ç´„CPA</div><div class="chart-sub2">æœˆåˆ¥æ¯”è¼ƒ</div></div>
        <div class="legend-row">
          <div class="legend-item"><div class="ldot" style="background:#7c3aed"></div>é¢è«‡CPA</div>
          <div class="legend-item"><div class="ldot" style="background:#10b981"></div>å¥‘ç´„CPA</div>
        </div>
      </div>
      <div style="position:relative;height:200px;"><canvas id="cpaCompare"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">å‰å¹´åŒæœˆæ¯” å¥‘ç´„æ•°</div><div class="chart-sub2">YoY æ¯”è¼ƒï¼ˆä»¶æ•°å·®ï¼‰</div></div></div>
      <div style="position:relative;height:200px;"><canvas id="yoyChart"></canvas></div>
    </div>
  </div>
</div>

<!-- ==================== PAGE: REPORT ==================== -->
<div id="page-report" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</h1></div>
    <button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ å°åˆ· / PDF</button>
  </div>

  <div class="g g3e" id="reportMonthCards"></div>

  <div class="g g2">
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">å…¨æœŸé–“ ã‚³ã‚¹ãƒˆæ¨ç§»</div></div></div>
      <div style="position:relative;height:200px;"><canvas id="rptCostChart"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd">
        <div><div class="chart-title">å…¨æœŸé–“ CVæ¨ç§»</div></div>
        <div class="legend-row">
          <div class="legend-item"><div class="ldot" style="background:#7c3aed"></div>é¢è«‡</div>
          <div class="legend-item"><div class="ldot" style="background:#10b981"></div>å¥‘ç´„</div>
        </div>
      </div>
      <div style="position:relative;height:200px;"><canvas id="rptCvChart"></canvas></div>
    </div>
  </div>

  <div class="table-wrap">
    <div class="table-hd"><div><div class="chart-title">å…¨æœŸé–“ æœˆæ¬¡ã‚µãƒãƒªãƒ¼</div></div></div>
    <div style="overflow-x:auto;overflow-y:auto;max-height:400px;">
      <table>
        <thead><tr>
          <th>Month</th><th>Cost</th><th>é¢è«‡æ•°</th><th>é¢è«‡CPA</th>
          <th>ä½“é¨“æ•°</th><th>ä½“é¨“CPA</th><th>å¥‘ç´„æ•°</th><th>å¥‘ç´„CPA</th><th>å‰å¹´æ¯”</th>
        </tr></thead>
        <tbody id="rptTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ==================== PAGE: SETTINGS ==================== -->
<div id="page-settings" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>è¨­å®š</h1></div>
    <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜</button>
  </div>

  <div class="g g2">
    <div>
      <div class="settings-group">
        <div class="settings-group-title">ğŸ“Š è¡¨ç¤ºè¨­å®š</div>
        <div class="settings-row">
          <div><div class="settings-label">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºæœŸé–“</div><div class="settings-desc">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èµ·å‹•æ™‚ã®åˆæœŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div></div>
          <select class="select-input" id="s-period">
            <option value="2025" selected>2025å¹´</option>
            <option value="2024">2024å¹´</option>
            <option value="all">å…¨æœŸé–“</option>
          </select>
        </div>
        <div class="settings-row">
          <div><div class="settings-label">é€šè²¨è¡¨ç¤º</div><div class="settings-desc">é‡‘é¡ã®è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</div></div>
          <select class="select-input" id="s-currency">
            <option value="jpy" selected>Â¥ å†† (JPY)</option>
            <option value="usd">$ ãƒ‰ãƒ« (USD)</option>
          </select>
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ã‚°ãƒ©ãƒ•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</div><div class="settings-desc">ãƒãƒ£ãƒ¼ãƒˆæç”»æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</div></div>
          <div class="toggle on" onclick="this.classList.toggle('on')" id="s-anim"></div>
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œæ•°</div><div class="settings-desc">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‰ã®æœ€å¤§è¡¨ç¤ºè¡Œæ•°</div></div>
          <select class="select-input" id="s-rows">
            <option value="5">5è¡Œ</option>
            <option value="8" selected>8è¡Œ</option>
            <option value="12">12è¡Œ</option>
            <option value="all">å…¨ä»¶</option>
          </select>
        </div>
      </div>

      <div class="settings-group">
        <div class="settings-group-title">ğŸ¨ ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒ</div>
        <div class="settings-row">
          <div><div class="settings-label">ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼</div><div class="settings-desc">ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ»ãƒœã‚¿ãƒ³ã®ã‚«ãƒ©ãƒ¼</div></div>
          <input type="color" value="#7c3aed" style="width:36px;height:36px;border:none;border-radius:8px;cursor:pointer;background:none;" id="s-color" onchange="applyColor(this.value)">
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div><div class="settings-desc">ç¾åœ¨: ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</div></div>
          <div class="toggle" onclick="this.classList.toggle('on')" id="s-dark"></div>
        </div>
      </div>
    </div>

    <div>
      <div class="settings-group">
        <div class="settings-group-title">ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š</div>
        <div class="settings-row">
          <div><div class="settings-label">ã‚³ã‚¹ãƒˆä¸Šé™ã‚¢ãƒ©ãƒ¼ãƒˆ</div><div class="settings-desc">æœˆæ¬¡ã‚³ã‚¹ãƒˆãŒã“ã®é‡‘é¡ã‚’è¶…ãˆãŸã‚‰è­¦å‘Šè¡¨ç¤º</div></div>
          <input type="number" class="text-input" id="s-cost-alert" value="150000" style="width:120px;">
        </div>
        <div class="settings-row">
          <div><div class="settings-label">CPAä¸Šé™ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆå¥‘ç´„ï¼‰</div><div class="settings-desc">å¥‘ç´„CPAãŒã“ã®é‡‘é¡ã‚’è¶…ãˆãŸã‚‰èµ¤è¡¨ç¤º</div></div>
          <input type="number" class="text-input" id="s-cpa-alert" value="30000" style="width:120px;">
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥</div><div class="settings-desc">ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«ãƒãƒŠãƒ¼è¡¨ç¤º</div></div>
          <div class="toggle on" onclick="this.classList.toggle('on')" id="s-alert-on"></div>
        </div>
      </div>

      <div class="settings-group">
        <div class="settings-group-title">ğŸ“ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
        <div class="settings-row">
          <div><div class="settings-label">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div><div class="settings-desc">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</div></div>
          <button class="btn btn-outline" onclick="exportCsv()">â¬‡ï¸ CSVå‡ºåŠ›</button>
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³</div><div class="settings-desc">æœ€çµ‚æ›´æ–°: 2026/02</div></div>
          <span class="badge badge-green">æœ€æ–°</span>
        </div>
        <div class="settings-row">
          <div><div class="settings-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢</div><div class="settings-desc">ã‚°ãƒ©ãƒ•ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ</div></div>
          <button class="btn btn-outline" onclick="location.reload()">ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- ==================== PAGE: WEEKLY REPORT ==================== -->
<div id="page-weekly" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>ğŸ“Š é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</h1></div>
    <div style="display:flex;gap:8px;">
      <button class="btn btn-outline" onclick="renderWeekly()">ğŸ”„ æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§ç”Ÿæˆ</button>
      <button class="btn btn-primary" onclick="exportWeeklyPDF()">ğŸ“„ PDFå‡ºåŠ›</button>
    </div>
  </div>

  <!-- ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒŠãƒ¼ -->
  <div id="weekly-alerts" style="margin-bottom:16px;"></div>

  <!-- KPIã‚«ãƒ¼ãƒ‰ -->
  <div class="g g4" id="weekly-kpi-cards">
    <div class="card"><div class="card-row"><div><div class="card-label">æœ€æ–°æœˆ ã‚³ã‚¹ãƒˆ</div><div class="card-value" id="w-cost">â€”</div><div class="card-sub" id="w-cost-diff">â€”</div></div><div class="card-icon icon-purple">ğŸ’°</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">é¢è«‡æ•°</div><div class="card-value" id="w-meet">â€”</div><div class="card-sub" id="w-meet-diff">â€”</div></div><div class="card-icon icon-blue">ğŸ‘¥</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">å¥‘ç´„æ•°</div><div class="card-value" id="w-cont">â€”</div><div class="card-sub" id="w-cont-diff">â€”</div></div><div class="card-icon icon-green">âœ…</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">å¥‘ç´„CPA</div><div class="card-value" id="w-contcpa">â€”</div><div class="card-sub" id="w-contcpa-diff">â€”</div></div><div class="card-icon icon-orange">ğŸ¯</div></div></div>
  </div>

  <!-- 3ãƒ¶æœˆå¹³å‡ -->
  <div class="g g3e">
    <div class="card"><div class="card-row"><div><div class="card-label">3ãƒ¶æœˆå¹³å‡ ã‚³ã‚¹ãƒˆ</div><div class="card-value" id="w-avg-cost">â€”</div></div><div class="card-icon icon-gray">ğŸ“Š</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">3ãƒ¶æœˆå¹³å‡ é¢è«‡æ•°</div><div class="card-value" id="w-avg-meet">â€”</div></div><div class="card-icon icon-gray">ğŸ“Š</div></div></div>
    <div class="card"><div class="card-row"><div><div class="card-label">3ãƒ¶æœˆå¹³å‡ å¥‘ç´„CPA</div><div class="card-value" id="w-avg-cpa">â€”</div></div><div class="card-icon icon-gray">ğŸ“Š</div></div></div>
  </div>

  <!-- ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆ -->
  <div class="g g2">
    <div class="chart-wrap">
      <div class="chart-hd"><div><div class="chart-title">ã‚³ã‚¹ãƒˆæ¨ç§»ï¼ˆç›´è¿‘6ãƒ¶æœˆï¼‰</div></div></div>
      <div style="position:relative;height:200px;"><canvas id="wCostChart"></canvas></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-hd">
        <div><div class="chart-title">CVæ¨ç§»ï¼ˆç›´è¿‘6ãƒ¶æœˆï¼‰</div></div>
        <div class="legend-row">
          <div class="legend-item"><div class="ldot" style="background:#7c3aed"></div>é¢è«‡</div>
          <div class="legend-item"><div class="ldot" style="background:#10b981"></div>å¥‘ç´„</div>
        </div>
      </div>
      <div style="position:relative;height:200px;"><canvas id="wCvChart"></canvas></div>
    </div>
  </div>

  <!-- è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div class="table-wrap">
    <div class="table-hd"><div class="chart-title">æœˆåˆ¥è©³ç´°ï¼ˆç›´è¿‘6ãƒ¶æœˆï¼‰</div></div>
    <div style="overflow-x:auto;">
      <table>
        <thead><tr><th>Month</th><th>Cost</th><th>é¢è«‡æ•°</th><th>é¢è«‡CPA</th><th>å¥‘ç´„æ•°</th><th>å¥‘ç´„CPA</th><th>å‰æœˆæ¯” Cost</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th></tr></thead>
        <tbody id="weeklyTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ==================== PAGE: BIWEEKLY PLAN ==================== -->
<div id="page-biweekly" class="page">
  <div class="topbar">
    <div class="topbar-left"><h1>ğŸ¯ æ”¹å–„ãƒ—ãƒ©ãƒ³</h1></div>
    <button class="btn btn-outline" onclick="renderBiweekly()">ğŸ”„ ãƒ—ãƒ©ãƒ³ã‚’å†ç”Ÿæˆ</button>
  </div>

  <!-- KPIç›®æ¨™ -->
  <div class="section-title">ğŸ“Œ æ¬¡ã®2é€±é–“ã®KPIç›®æ¨™</div>
  <div class="g g4">
    <div class="card" style="border-top:3px solid #10b981;"><div class="card-label">ç›®æ¨™ é¢è«‡CPA</div><div class="card-value" id="b-kpi-meetcpa" style="color:#10b981;">â€”</div><div class="card-sub">ç¾çŠ¶æ¯” -10%</div></div>
    <div class="card" style="border-top:3px solid #10b981;"><div class="card-label">ç›®æ¨™ å¥‘ç´„CPA</div><div class="card-value" id="b-kpi-contcpa" style="color:#10b981;">â€”</div><div class="card-sub">ç¾çŠ¶æ¯” -10%</div></div>
    <div class="card" style="border-top:3px solid #3b82f6;"><div class="card-label">ç›®æ¨™ è»¢æ›ç‡</div><div class="card-value" id="b-kpi-conv" style="color:#3b82f6;">â€”</div><div class="card-sub">é¢è«‡â†’å¥‘ç´„</div></div>
    <div class="card" style="border-top:3px solid #7c3aed;"><div class="card-label">ç›®æ¨™ æœˆé–“å¥‘ç´„æ•°</div><div class="card-value" id="b-kpi-cont" style="color:#7c3aed;">â€”</div><div class="card-sub">ä»¶</div></div>
  </div>

  <!-- æ”¹å–„èª²é¡Œ -->
  <div class="section-title">âš¡ æ”¹å–„èª²é¡Œï¼ˆå„ªå…ˆé †ä½é †ï¼‰</div>
  <div id="biweekly-issues"></div>

  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
  <div class="section-title">ğŸ“… 14æ—¥é–“ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
  <div class="table-wrap">
    <div style="overflow-x:auto;">
      <table>
        <thead><tr><th style="text-align:left;">æœŸé–“</th><th style="text-align:left;">ãƒ•ã‚§ãƒ¼ã‚º</th><th style="text-align:left;">ã‚¿ã‚¹ã‚¯</th></tr></thead>
        <tbody id="biweeklyCalBody"></tbody>
      </table>
    </div>
  </div>
</div>

</main>

<script>
// ========== GAS æ¥ç¶šè¨­å®š ==========
// â–¼ GASãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨è‡ªå‹•ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ã¾ã™
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzi3QZSIo27aD3Y8gd_Tqa60n7Px0CvuK6wNRHckeRW8_9xST1WkI8Vpyi3nLeKhX25/exec';

// ========== åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰==========
// GASæœªæ¥ç¶šæ™‚ã¯ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã€‚æ¥ç¶šå¾Œã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚
const FALLBACK_DATA = [
  {month:'2024/05',cost:19216,  appt:1, apptCpa:19216, meet:1, meetCpa:19216, exp:1, expCpa:19216, cont:1, contCpa:19216, yoyC:null, yoyCpa:null},
  {month:'2024/06',cost:40513,  appt:0, apptCpa:null,  meet:0, meetCpa:null,  exp:0, expCpa:null,  cont:0, contCpa:null,  yoyC:null, yoyCpa:null},
  {month:'2024/07',cost:54873,  appt:1, apptCpa:54873, meet:1, meetCpa:54873, exp:1, expCpa:54873, cont:1, contCpa:54873, yoyC:null, yoyCpa:null},
  {month:'2024/08',cost:61692,  appt:2, apptCpa:30846, meet:2, meetCpa:30846, exp:2, expCpa:30846, cont:2, contCpa:30846, yoyC:null, yoyCpa:null},
  {month:'2024/09',cost:66618,  appt:1, apptCpa:66618, meet:1, meetCpa:66618, exp:1, expCpa:66618, cont:1, contCpa:66618, yoyC:null, yoyCpa:null},
  {month:'2024/10',cost:72559,  appt:3, apptCpa:24186, meet:3, meetCpa:24186, exp:3, expCpa:24186, cont:3, contCpa:24186, yoyC:null, yoyCpa:null},
  {month:'2024/11',cost:108615, appt:5, apptCpa:21723, meet:5, meetCpa:21723, exp:5, expCpa:21723, cont:5, contCpa:21723, yoyC:null, yoyCpa:null},
  {month:'2024/12',cost:92780,  appt:4, apptCpa:23195, meet:4, meetCpa:23195, exp:4, expCpa:23195, cont:4, contCpa:23195, yoyC:null, yoyCpa:null},
  {month:'2025/01',cost:93335,  appt:5, apptCpa:18667, meet:5, meetCpa:18667, exp:5, expCpa:18667, cont:5, contCpa:18667, yoyC:null, yoyCpa:null},
  {month:'2025/02',cost:99475,  appt:4, apptCpa:24869, meet:4, meetCpa:24869, exp:4, expCpa:24869, cont:4, contCpa:24869, yoyC:null, yoyCpa:null},
  {month:'2025/03',cost:98409,  appt:7, apptCpa:14058, meet:7, meetCpa:14058, exp:6, expCpa:16402, cont:null,contCpa:null, yoyC:null, yoyCpa:null},
  {month:'2025/04',cost:64672,  appt:6, apptCpa:10779, meet:9, meetCpa:10779, exp:6, expCpa:10779, cont:null,contCpa:null, yoyC:null, yoyCpa:null},
  {month:'2025/05',cost:85107,  appt:1, apptCpa:85107, meet:1, meetCpa:85107, exp:1, expCpa:85107, cont:1, contCpa:85107, yoyC:0,    yoyCpa:65891},
  {month:'2025/06',cost:53098,  appt:3, apptCpa:17699, meet:3, meetCpa:17699, exp:3, expCpa:17699, cont:3, contCpa:17699, yoyC:null, yoyCpa:null},
  {month:'2025/07',cost:81776,  appt:5, apptCpa:16355, meet:4, meetCpa:20444, exp:3, expCpa:27259, cont:2, contCpa:null,  yoyC:null, yoyCpa:27614},
  {month:'2025/08',cost:83795,  appt:7, apptCpa:11971, meet:7, meetCpa:11971, exp:2, expCpa:41898, cont:0, contCpa:11052, yoyC:null, yoyCpa:null},
  {month:'2025/09',cost:114052, appt:9, apptCpa:12672, meet:7, meetCpa:16293, exp:1, expCpa:114052,cont:0, contCpa:47434, yoyC:null, yoyCpa:null},
  {month:'2025/10',cost:126404, appt:10,apptCpa:12640, meet:9, meetCpa:14045, exp:5, expCpa:25281, cont:2, contCpa:1094,  yoyC:null, yoyCpa:null},
  {month:'2025/11',cost:120186, appt:9, apptCpa:13354, meet:9, meetCpa:13354, exp:6, expCpa:20031, cont:7, contCpa:17169, yoyC:2,    yoyCpa:-4554},
  {month:'2025/12',cost:193622, appt:15,apptCpa:12908, meet:13,meetCpa:14894, exp:10,expCpa:19362, cont:10,contCpa:19362, yoyC:6,    yoyCpa:-3833},
  {month:'2026/01',cost:96481,  appt:13,apptCpa:7422,  meet:11,meetCpa:8771,  exp:6, expCpa:16080, cont:6, contCpa:16080, yoyC:1,    yoyCpa:-2587},
  {month:'2026/02',cost:144862, appt:8, apptCpa:18108, meet:5, meetCpa:28972, exp:3, expCpa:48287, cont:3, contCpa:48287, yoyC:-1,   yoyCpa:23419},
];

let ALL = [...FALLBACK_DATA]; // åˆæœŸè¡¨ç¤ºã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

async function loadFromGAS() {
  // GAS URLãŒæœªè¨­å®šã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼‰
  if (!GAS_URL || GAS_URL === 'YOUR_GAS_URL_HERE') {
    document.getElementById('last-updated').textContent = 'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­';
    return true;
  }
  showLoading(true);
  try {
    const res = await fetch(GAS_URL);
    if (!res.ok) throw new Error('HTTPã‚¨ãƒ©ãƒ¼: ' + res.status);
    const json = await res.json();
    if (json.error) throw new Error(json.error);
    ALL = json.data; // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ã
    showLoading(false);
    showLastUpdated(json.updated);
    return true;
  } catch(err) {
    showLoading(false);
    showError('GASæ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºä¸­ï¼‰: ' + err.message);
    return true; // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã§ç¶šè¡Œ
  }
}

  function showLoading(on) {
  const el = document.getElementById('loading-banner');
  if (el) {
    el.style.display = on ? 'flex' : 'none';
  }
}
  function showLastUpdated(iso) {
  if (!iso) return;
  const d = new Date(iso);
  const s = d.toLocaleDateString('ja-JP') + ' ' + d.toLocaleTimeString('ja-JP', {hour:'2-digit',minute:'2-digit'});
  document.getElementById('last-updated').textContent = 'æœ€çµ‚æ›´æ–°: ' + s;
}
function showError(msg) {
  const el = document.getElementById('error-banner');
  el.textContent = 'âš ï¸ ' + msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 6000);
}

const fmt = v => v==null ? 'â€”' : 'Â¥'+v.toLocaleString();
const fmtN = v => v==null ? 'â€”' : v+'ä»¶';
const avg = arr => { const v=arr.filter(x=>x!=null); return v.length ? Math.round(v.reduce((a,b)=>a+b,0)/v.length) : null; };
const cc = v => v==null?'muted':v<15000?'cpa-low':v<30000?'cpa-mid':'cpa-high';

let charts = {};
let activePeriod='2025', activeMonth=null;
let activePeriodCost='2025', activePeriodCv='2025';

const filterData = (period) => period==='all' ? ALL : ALL.filter(d=>d.month.startsWith(period));
const getFiltered = () => {
  let d = filterData(activePeriod);
  if (activeMonth) d = d.filter(r=>r.month===activeMonth);
  return d;
};

const tipBase = (label) => ({
  backgroundColor:'#1f2937',titleColor:'#f9fafb',bodyColor:'#d1d5db',cornerRadius:8,callbacks:{label}
});
const scaleXY = (yFmt) => ({
  x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},
  y:{ticks:{color:'#9ca3af',font:{size:10},callback:yFmt},grid:{color:'#f3f4f6'}}
});

function mkChart(id,type,labels,datasets,opts={}) {
  if (charts[id]) charts[id].destroy();
  charts[id] = new Chart(document.getElementById(id),{type,data:{labels,datasets},options:{responsive:true,maintainAspectRatio:false,...opts}});
}

// ========== PAGE NAVIGATION ==========
function showPage(page, el, title) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.bnav-item').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼å´ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  if (el) el.classList.add('active');

  // ãƒœãƒˆãƒ ãƒŠãƒ“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  const bnav = document.getElementById('bnav-'+page);
  if (bnav) bnav.classList.add('active');

  // ãƒ¢ãƒã‚¤ãƒ«ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
  const titles = {dashboard:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',cost:'ã‚³ã‚¹ãƒˆåˆ†æ',cv:'CVè©³ç´°',report:'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',settings:'è¨­å®š'};
  document.getElementById('mobilePageTitle').textContent = title || titles[page] || '';

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹ï¼ˆã‚¹ãƒãƒ›æ™‚ï¼‰
  closeSidebar();

  // ãƒšãƒ¼ã‚¸å…ˆé ­ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  document.querySelector('.main').scrollTop = 0;

  if (page==='dashboard') render();
  if (page==='cost') renderCost();
  if (page==='cv') renderCv();
  if (page==='report') renderReport();
  if (page==='weekly') renderWeekly();
  if (page==='biweekly') renderBiweekly();
}

// ===== SIDEBAR TOGGLE =====
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
}

// ========== DASHBOARD ==========
function render() {
  const data = getFiltered();
  // KPIs
  document.getElementById('totalCost').textContent = 'Â¥'+data.reduce((s,d)=>s+d.cost,0).toLocaleString();
  const last = [...data].reverse().find(d=>d.cost);
  if(last){
    document.getElementById('latestCost').textContent=fmt(last.cost);
    document.getElementById('latestMonth').textContent=last.month;
    document.getElementById('latestMeetCpa').textContent=fmt(last.meetCpa);
    document.getElementById('latestMeetN').textContent='é¢è«‡æ•°: '+fmtN(last.meet);
  }
  document.getElementById('totalMeet').textContent=data.reduce((s,d)=>s+(d.meet||0),0)+'ä»¶';
  document.getElementById('totalExp').textContent=data.reduce((s,d)=>s+(d.exp||0),0)+'ä»¶';
  document.getElementById('totalCont').textContent=data.reduce((s,d)=>s+(d.cont||0),0)+'ä»¶';
  const best=data.filter(d=>d.contCpa).reduce((b,d)=>(!b||d.contCpa<b.contCpa)?d:b,null);
  if(best){document.getElementById('bestCpa').textContent=fmt(best.contCpa);document.getElementById('bestCpaMonth').textContent=best.month;}
  document.getElementById('avgApptCpa').textContent=fmt(avg(data.map(d=>d.apptCpa)));
  document.getElementById('avgExpCpa').textContent=fmt(avg(data.map(d=>d.expCpa)));
  document.getElementById('avgContCpa').textContent=fmt(avg(data.map(d=>d.contCpa)));
  // Charts
  const labels=data.map(d=>d.month.slice(5));
  const ks=scaleXY(v=>'Â¥'+(v/1000).toFixed(0)+'k');
  mkChart('costChart','bar',labels,[{data:data.map(d=>d.cost),backgroundColor:data.map(d=>d.cost>150000?'rgba(239,68,68,0.7)':'rgba(124,58,237,0.55)'),borderColor:data.map(d=>d.cost>150000?'#ef4444':'#7c3aed'),borderWidth:1.5,borderRadius:6}],{plugins:{legend:{display:false},tooltip:tipBase(c=>'Â¥'+c.raw.toLocaleString())},scales:ks});
  mkChart('cvChart','line',labels,[
    {label:'é¢è«‡',data:data.map(d=>d.meet),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:3,fill:true},
    {label:'ä½“é¨“',data:data.map(d=>d.exp), borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,0.08)', tension:0.4,pointRadius:3,fill:false},
    {label:'å¥‘ç´„',data:data.map(d=>d.cont),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.08)',tension:0.4,pointRadius:3,fill:false},
  ],{plugins:{legend:{display:false},tooltip:tipBase(c=>c.dataset.label+': '+c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}}}});
  const mkCpa=(id,key,color)=>mkChart(id,'line',labels,[{data:data.map(d=>d[key]),borderColor:color,backgroundColor:color.replace(')',',0.08)').replace('rgb','rgba'),tension:0.4,pointRadius:2,fill:true,spanGaps:false}],{plugins:{legend:{display:false},tooltip:tipBase(c=>fmt(c.raw))},scales:{x:{ticks:{color:'#9ca3af',font:{size:9}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:9},callback:v=>'Â¥'+(v/1000).toFixed(0)+'k'},grid:{color:'#f3f4f6'}}}});
  mkCpa('cpa1','meetCpa','rgb(124,58,237)');
  mkCpa('cpa2','expCpa','rgb(6,182,212)');
  mkCpa('cpa3','contCpa','rgb(16,185,129)');
  // Table
  const tbody=document.getElementById('tableBody');
  tbody.innerHTML='';
  [...data].reverse().forEach(d=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.month}</td><td class="cost">${fmt(d.cost)}</td><td>${fmtN(d.appt)}</td><td class="${cc(d.apptCpa)}">${fmt(d.apptCpa)}</td><td>${fmtN(d.meet)}</td><td class="${cc(d.meetCpa)}">${fmt(d.meetCpa)}</td><td>${fmtN(d.exp)}</td><td class="${cc(d.expCpa)}">${fmt(d.expCpa)}</td><td>${fmtN(d.cont)}</td><td class="${cc(d.contCpa)}">${fmt(d.contCpa)}</td><td class="${d.yoyC==null?'muted':d.yoyC>=0?'pos':'neg'}">${d.yoyC==null?'â€”':(d.yoyC>=0?'+':'')+d.yoyC+'ä»¶'}</td><td class="${d.yoyCpa==null?'muted':d.yoyCpa<=0?'pos':'neg'}">${d.yoyCpa==null?'â€”':(d.yoyCpa>=0?'+':'')+fmt(d.yoyCpa).replace('Â¥','')}</td>`;
    tbody.appendChild(tr);
  });
}

function buildChips(period) {
  const c=document.getElementById('monthChips'); c.innerHTML='';
  const all=document.createElement('div');
  all.className='chip chip-all'; all.textContent='ã™ã¹ã¦';
  all.onclick=()=>{activeMonth=null;render();buildChips(period);};
  c.appendChild(all);
  const months=period==='all'?ALL.map(d=>d.month):ALL.filter(d=>d.month.startsWith(period)).map(d=>d.month);
  months.forEach(m=>{
    const chip=document.createElement('div');
    chip.className='chip chip-month'+(activeMonth===m?' active':'');
    chip.textContent=m;
    chip.onclick=()=>{activeMonth=m;document.querySelectorAll('.chip-month').forEach(c=>c.classList.remove('active'));chip.classList.add('active');render();};
    c.appendChild(chip);
  });
}

function filterPeriod(p,el) {
  activePeriod=p; activeMonth=null;
  document.querySelectorAll('#page-dashboard .period-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  buildChips(p); render();
}

// ========== COST ==========
function renderCost() {
  const data = filterData(activePeriodCost);
  const labels = data.map(d=>d.month.slice(5));
  const costs = data.map(d=>d.cost);
  const total = costs.reduce((a,b)=>a+b,0);
  const avgC = Math.round(total/costs.length);
  const maxD = data.reduce((b,d)=>d.cost>b.cost?d:b);
  const minD = data.reduce((b,d)=>d.cost<b.cost?d:b);

  document.getElementById('c-total').textContent = fmt(total);
  document.getElementById('c-avg').textContent = fmt(avgC);
  document.getElementById('c-max').textContent = fmt(maxD.cost);
  document.getElementById('c-max-m').textContent = maxD.month;
  document.getElementById('c-min').textContent = fmt(minD.cost);
  document.getElementById('c-min-m').textContent = minD.month;

  const ks=scaleXY(v=>'Â¥'+(v/1000).toFixed(0)+'k');
  mkChart('costBar2','bar',labels,[{data:costs,backgroundColor:costs.map(c=>c>150000?'rgba(239,68,68,0.7)':'rgba(124,58,237,0.55)'),borderColor:costs.map(c=>c>150000?'#ef4444':'#7c3aed'),borderWidth:1.5,borderRadius:6}],{plugins:{legend:{display:false},tooltip:tipBase(c=>'Â¥'+c.raw.toLocaleString())},scales:ks});

  // Distribution donut
  const bins = [0,0,0,0]; // <50k, 50-100k, 100-150k, 150k+
  costs.forEach(c=>{ if(c<50000)bins[0]++; else if(c<100000)bins[1]++; else if(c<150000)bins[2]++; else bins[3]++; });
  mkChart('costDist','doughnut',['ã€œ5ä¸‡','5ã€œ10ä¸‡','10ã€œ15ä¸‡','15ä¸‡ã€œ'],[{data:bins,backgroundColor:['#a78bfa','#7c3aed','#f59e0b','#ef4444'],borderWidth:0}],{plugins:{legend:{display:true,position:'bottom',labels:{color:'#6b7280',font:{size:11}}},tooltip:tipBase(c=>c.raw+'ãƒ¶æœˆ')},cutout:'60%'});

  mkChart('costLine','line',labels,[{data:costs,borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:3,fill:true}],{plugins:{legend:{display:false},tooltip:tipBase(c=>'Â¥'+c.raw.toLocaleString())},scales:ks});

  // Table
  const tbody=document.getElementById('costTableBody'); tbody.innerHTML='';
  [...data].reverse().forEach((d,i,arr)=>{
    const prev = arr[i+1];
    const diff = prev ? d.cost-prev.cost : null;
    const vsAvg = d.cost - avgC;
    let badge = '';
    if(d.cost>150000) badge='<span class="badge badge-red">é«˜ã‚³ã‚¹ãƒˆ</span>';
    else if(d.cost<70000) badge='<span class="badge badge-green">ä½ã‚³ã‚¹ãƒˆ</span>';
    else badge='<span class="badge badge-blue">é€šå¸¸</span>';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.month}</td><td class="cost">${fmt(d.cost)}</td><td class="${diff==null?'muted':diff>0?'neg':'pos'}">${diff==null?'â€”':(diff>0?'+':'')+fmt(diff).replace('Â¥','')}</td><td class="${vsAvg>0?'neg':'pos'}">${vsAvg>0?'+':''+''}${fmt(vsAvg).replace('Â¥','')}</td><td>${badge}</td>`;
    tbody.appendChild(tr);
  });
}

function filterPeriodCost(p,el) {
  activePeriodCost=p;
  document.querySelectorAll('#page-cost .period-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderCost();
}

// ========== CV ==========
function renderCv() {
  const data = filterData(activePeriodCv);
  const labels = data.map(d=>d.month.slice(5));
  const totalMeet = data.reduce((s,d)=>s+(d.meet||0),0);
  const totalExp  = data.reduce((s,d)=>s+(d.exp||0),0);
  const totalCont = data.reduce((s,d)=>s+(d.cont||0),0);
  const maxMeet = Math.max(...data.map(d=>d.meet||0));

  document.getElementById('cv-meet').textContent = totalMeet+'ä»¶';
  document.getElementById('cv-exp').textContent = totalExp+'ä»¶';
  document.getElementById('cv-cont').textContent = totalCont+'ä»¶';
  setTimeout(()=>{
    document.getElementById('cv-meet-bar').style.width='100%';
    document.getElementById('cv-exp-bar').style.width=(totalMeet>0?totalExp/totalMeet*100:0)+'%';
    document.getElementById('cv-cont-bar').style.width=(totalMeet>0?totalCont/totalMeet*100:0)+'%';
  },100);

  const r1 = totalMeet>0 ? (totalExp/totalMeet*100).toFixed(1)+'%' : 'â€”';
  const r2 = totalExp>0  ? (totalCont/totalExp*100).toFixed(1)+'%' : 'â€”';
  const r3 = totalMeet>0 ? (totalCont/totalMeet*100).toFixed(1)+'%' : 'â€”';
  document.getElementById('cv-r1').textContent = r1;
  document.getElementById('cv-r2').textContent = r2;
  document.getElementById('cv-r3').textContent = r3;

  mkChart('cvLine','line',labels,[
    {label:'é¢è«‡',data:data.map(d=>d.meet),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:3,fill:true},
    {label:'ä½“é¨“',data:data.map(d=>d.exp), borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,0.06)', tension:0.4,pointRadius:3,fill:false},
    {label:'å¥‘ç´„',data:data.map(d=>d.cont),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.06)',tension:0.4,pointRadius:3,fill:false},
  ],{plugins:{legend:{display:false},tooltip:tipBase(c=>c.dataset.label+': '+c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}}}});

  mkChart('cvFunnel','bar',['é¢è«‡äºˆç´„','é¢è«‡','ä½“é¨“','å¥‘ç´„'],[{data:[data.reduce((s,d)=>s+(d.appt||0),0),totalMeet,totalExp,totalCont],backgroundColor:['rgba(167,139,250,0.7)','rgba(124,58,237,0.7)','rgba(6,182,212,0.7)','rgba(16,185,129,0.7)'],borderColor:['#a78bfa','#7c3aed','#06b6d4','#10b981'],borderWidth:1.5,borderRadius:6}],{indexAxis:'y',plugins:{legend:{display:false},tooltip:tipBase(c=>c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:11}},grid:{display:false}}}});

  mkChart('cpaCompare','line',labels,[
    {label:'é¢è«‡CPA',data:data.map(d=>d.meetCpa),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.05)',tension:0.4,pointRadius:3,fill:false,spanGaps:false},
    {label:'å¥‘ç´„CPA',data:data.map(d=>d.contCpa),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.05)',tension:0.4,pointRadius:3,fill:false,spanGaps:false},
  ],{plugins:{legend:{display:false},tooltip:tipBase(c=>c.dataset.label+': '+fmt(c.raw))},scales:scaleXY(v=>'Â¥'+(v/1000).toFixed(0)+'k')});

  const yoyData = data.filter(d=>d.yoyC!=null);
  mkChart('yoyChart','bar',yoyData.map(d=>d.month.slice(5)),[{data:yoyData.map(d=>d.yoyC),backgroundColor:yoyData.map(d=>d.yoyC>=0?'rgba(16,185,129,0.6)':'rgba(239,68,68,0.6)'),borderColor:yoyData.map(d=>d.yoyC>=0?'#10b981':'#ef4444'),borderWidth:1.5,borderRadius:4}],{plugins:{legend:{display:false},tooltip:tipBase(c=>(c.raw>=0?'+':'')+c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}}}});
}

function filterPeriodCv(p,el) {
  activePeriodCv=p;
  document.querySelectorAll('#page-cv .period-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderCv();
}

// ========== REPORT ==========
function renderReport() {
  const data = ALL;

  // Highlight cards: last 3 months
  const last3 = [...data].slice(-3).reverse();
  const cardsEl = document.getElementById('reportMonthCards');
  cardsEl.innerHTML = '';
  last3.forEach(d=>{
    const el = document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <div class="card-label">${d.month} ã‚µãƒãƒªãƒ¼</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div class="card-value-sm">${fmt(d.cost)}</div>
        <div class="card-icon icon-purple" style="font-size:14px;">ğŸ’°</div>
      </div>
      <div style="display:flex;gap:12px;margin-top:8px;flex-wrap:wrap;">
        <div style="font-size:12px;color:#374151;">é¢è«‡ <strong>${fmtN(d.meet)}</strong></div>
        <div style="font-size:12px;color:#374151;">ä½“é¨“ <strong>${fmtN(d.exp)}</strong></div>
        <div style="font-size:12px;color:#374151;">å¥‘ç´„ <strong>${fmtN(d.cont)}</strong></div>
      </div>
      <div style="margin-top:8px;font-size:12px;">
        å¥‘ç´„CPA: <span class="${cc(d.contCpa)}" style="font-weight:600;">${fmt(d.contCpa)}</span>
      </div>`;
    cardsEl.appendChild(el);
  });

  const labels=data.map(d=>d.month.slice(5));
  const ks=scaleXY(v=>'Â¥'+(v/1000).toFixed(0)+'k');
  mkChart('rptCostChart','line',labels,[{data:data.map(d=>d.cost),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:2,fill:true}],{plugins:{legend:{display:false},tooltip:tipBase(c=>'Â¥'+c.raw.toLocaleString())},scales:ks});
  mkChart('rptCvChart','line',labels,[
    {label:'é¢è«‡',data:data.map(d=>d.meet),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:2,fill:true},
    {label:'å¥‘ç´„',data:data.map(d=>d.cont),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.08)',tension:0.4,pointRadius:2,fill:false},
  ],{plugins:{legend:{display:false},tooltip:tipBase(c=>c.dataset.label+': '+c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}}}});

  const tbody=document.getElementById('rptTableBody'); tbody.innerHTML='';
  [...data].reverse().forEach(d=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.month}</td><td class="cost">${fmt(d.cost)}</td><td>${fmtN(d.meet)}</td><td class="${cc(d.meetCpa)}">${fmt(d.meetCpa)}</td><td>${fmtN(d.exp)}</td><td class="${cc(d.expCpa)}">${fmt(d.expCpa)}</td><td>${fmtN(d.cont)}</td><td class="${cc(d.contCpa)}">${fmt(d.contCpa)}</td><td class="${d.yoyC==null?'muted':d.yoyC>=0?'pos':'neg'}">${d.yoyC==null?'â€”':(d.yoyC>=0?'+':'')+d.yoyC+'ä»¶'}</td>`;
    tbody.appendChild(tr);
  });
}

// ========== SETTINGS ==========
function saveSettings() {
  alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆã“ã®ãƒ‡ãƒ¢ã§ã¯ç”»é¢å†…ã®ã¿ã«é©ç”¨ã•ã‚Œã¾ã™ï¼‰');
}

function applyColor(color) {
  document.querySelector('.sidebar').style.background = color;
  document.querySelectorAll('.btn-primary').forEach(b=>b.style.background=color);
  document.querySelectorAll('.chip-all').forEach(c=>{ c.style.color=color; c.style.borderColor=color; });
}

function exportCsv() {
  const rows = [['Month','Cost','é¢è«‡äºˆç´„æ•°','é¢è«‡äºˆç´„CPA','é¢è«‡æ•°','é¢è«‡CPA','ä½“é¨“æ•°','ä½“é¨“CPA','å¥‘ç´„æ•°','å¥‘ç´„CPA','å‰å¹´æ¯”å¥‘ç´„æ•°','å‰å¹´æ¯”CPA']];
  ALL.forEach(d=>rows.push([d.month,d.cost,d.appt,d.apptCpa??'',d.meet,d.meetCpa??'',d.exp,d.expCpa??'',d.cont??'',d.contCpa??'',d.yoyC??'',d.yoyCpa??'']));
  const csv = rows.map(r=>r.join(',')).join('\n');
  const a=document.createElement('a');
  a.href='data:text/csv;charset=utf-8,\uFEFF'+encodeURIComponent(csv);
  a.download='ad_performance.csv';
  a.click();
}


// ========== WEEKLY REPORT ==========
function renderWeekly() {
  const data = ALL.slice(-6);
  if (!data.length) return;

  const latest = data[data.length - 1];
  const prev   = data.length >= 2 ? data[data.length - 2] : null;
  const prev3  = data.slice(-4, -1);

  const avgFn = (arr, key) => {
    const v = arr.map(d=>d[key]).filter(x=>x!=null);
    return v.length ? Math.round(v.reduce((a,b)=>a+b,0)/v.length) : null;
  };
  const diffV = (a,b,k) => (a&&b&&a[k]!=null&&b[k]!=null) ? a[k]-b[k] : null;
  const fmtDiff = (v, good='positive') => {
    if (v==null) return 'â€”';
    const isGood = good==='positive' ? v>0 : v<0;
    const color = isGood ? '#16a34a' : '#dc2626';
    return `<span style="color:${color}">${v>0?'+':''}${v.toLocaleString()}</span>`;
  };

  // KPI cards
  document.getElementById('w-cost').textContent = fmt(latest.cost);
  document.getElementById('w-cost-diff').innerHTML = 'å‰æœˆæ¯”: ' + fmtDiff(diffV(latest,prev,'cost'),'negative');
  document.getElementById('w-meet').textContent = fmtN(latest.meet);
  document.getElementById('w-meet-diff').innerHTML = 'å‰æœˆæ¯”: ' + fmtDiff(diffV(latest,prev,'meet'),'positive');
  document.getElementById('w-cont').textContent = fmtN(latest.cont);
  document.getElementById('w-cont-diff').innerHTML = 'å‰æœˆæ¯”: ' + fmtDiff(diffV(latest,prev,'cont'),'positive');
  document.getElementById('w-contcpa').textContent = fmt(latest.contCpa);
  document.getElementById('w-contcpa-diff').innerHTML = 'å‰æœˆæ¯”: ' + fmtDiff(diffV(latest,prev,'contCpa'),'negative');

  // 3ãƒ¶æœˆå¹³å‡
  document.getElementById('w-avg-cost').textContent = fmt(avgFn(prev3,'cost'));
  document.getElementById('w-avg-meet').textContent = fmtN(avgFn(prev3,'meet'));
  document.getElementById('w-avg-cpa').textContent  = fmt(avgFn(prev3,'contCpa'));

  // ã‚¢ãƒ©ãƒ¼ãƒˆ
  const alerts = [];
  if (latest.cost > 150000) alerts.push({level:'high', msg:`ã‚³ã‚¹ãƒˆä¸Šé™è¶…é: ${fmt(latest.cost)}`});
  if (latest.contCpa && latest.contCpa > 30000) alerts.push({level:'high', msg:`å¥‘ç´„CPAä¸Šé™è¶…é: ${fmt(latest.contCpa)}`});
  if (!latest.cont) alerts.push({level:'medium', msg:'ä»Šæœˆã®å¥‘ç´„æ•°ãŒ0ä»¶ã§ã™'});
  const alertEl = document.getElementById('weekly-alerts');
  if (alerts.length) {
    alertEl.innerHTML = alerts.map(a=>`
      <div style="background:${a.level==='high'?'#fee2e2':'#fef3c7'};border-left:4px solid ${a.level==='high'?'#dc2626':'#f59e0b'};padding:10px 16px;border-radius:8px;margin-bottom:8px;font-size:13px;">
        ${a.level==='high'?'ğŸš¨':'âš ï¸'} ${a.msg}
      </div>`).join('');
  } else {
    alertEl.innerHTML = '<div style="background:#dcfce7;border-left:4px solid #16a34a;padding:10px 16px;border-radius:8px;font-size:13px;">âœ… ç•°å¸¸ãªã—ã€‚è‰¯å¥½ãªçŠ¶æ…‹ã§ã™ã€‚</div>';
  }

  // Charts
  const labels = data.map(d=>d.month.slice(5));
  const ks = scaleXY(v=>'Â¥'+(v/1000).toFixed(0)+'k');
  mkChart('wCostChart','bar',labels,[{data:data.map(d=>d.cost),backgroundColor:data.map(d=>d.cost>150000?'rgba(239,68,68,0.7)':'rgba(124,58,237,0.55)'),borderColor:data.map(d=>d.cost>150000?'#ef4444':'#7c3aed'),borderWidth:1.5,borderRadius:6}],{plugins:{legend:{display:false},tooltip:tipBase(c=>'Â¥'+c.raw.toLocaleString())},scales:ks});
  mkChart('wCvChart','line',labels,[
    {label:'é¢è«‡',data:data.map(d=>d.meet),borderColor:'#7c3aed',backgroundColor:'rgba(124,58,237,0.08)',tension:0.4,pointRadius:4,fill:true},
    {label:'å¥‘ç´„',data:data.map(d=>d.cont),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.08)',tension:0.4,pointRadius:4,fill:false},
  ],{plugins:{legend:{display:false},tooltip:tipBase(c=>c.dataset.label+': '+c.raw+'ä»¶')},scales:{x:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}},y:{ticks:{color:'#9ca3af',font:{size:10}},grid:{color:'#f3f4f6'}}}});

  // Table
  const tbody = document.getElementById('weeklyTableBody');
  tbody.innerHTML = '';
  [...data].reverse().forEach((d,i,arr) => {
    const p = arr[i+1];
    const costDiff = p ? d.cost - p.cost : null;
    const status = d.cost > 150000 ? '<span class="badge badge-red">é«˜ã‚³ã‚¹ãƒˆ</span>'
                 : d.contCpa && d.contCpa > 30000 ? '<span class="badge badge-red">CPAé«˜é¨°</span>'
                 : d.cont > 5 ? '<span class="badge badge-green">å¥½èª¿</span>'
                 : '<span class="badge badge-blue">é€šå¸¸</span>';
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${d.month}</td><td class="cost">${fmt(d.cost)}</td><td>${fmtN(d.meet)}</td><td class="${cc(d.meetCpa)}">${fmt(d.meetCpa)}</td><td>${fmtN(d.cont)}</td><td class="${cc(d.contCpa)}">${fmt(d.contCpa)}</td><td class="${costDiff==null?'muted':costDiff>0?'neg':'pos'}">${costDiff==null?'â€”':(costDiff>0?'+':'')+fmt(costDiff).replace('Â¥','')}</td><td>${status}</td>`;
    tbody.appendChild(tr);
  });
}

function exportWeeklyPDF() { window.print(); }

// ========== BIWEEKLY PLAN ==========
function renderBiweekly() {
  const data = ALL.slice(-6);
  if (!data.length) return;

  const latest   = data[data.length-1];
  const avgFn = (arr,key) => { const v=arr.map(d=>d[key]).filter(x=>x!=null); return v.length?Math.round(v.reduce((a,b)=>a+b,0)/v.length):null; };

  const totalMeet = data.reduce((s,d)=>s+(d.meet||0),0);
  const totalCont = data.reduce((s,d)=>s+(d.cont||0),0);
  const convRate  = totalMeet > 0 ? totalCont/totalMeet : 0;
  const avgContCpa = avgFn(data,'contCpa');

  // KPI targets
  document.getElementById('b-kpi-meetcpa').textContent = fmt(Math.round((avgFn(data,'meetCpa')||20000)*0.9));
  document.getElementById('b-kpi-contcpa').textContent = fmt(Math.round((avgContCpa||30000)*0.9));
  document.getElementById('b-kpi-conv').textContent    = Math.min(50,Math.round(convRate*100)+10)+'%';
  document.getElementById('b-kpi-cont').textContent    = Math.max((latest.cont||0)+2,5)+'ä»¶';

  // Issues
  const issues = [];
  if (avgContCpa && latest.contCpa && latest.contCpa > avgContCpa*1.2) {
    issues.push({p:1, cat:'CPAæ”¹å–„', title:'å¥‘ç´„CPAã®é«˜é¨°', detail:`ç›´è¿‘CPA ${fmt(latest.contCpa)} ã¯6ãƒ¶æœˆå¹³å‡ ${fmt(avgContCpa)} ã‚ˆã‚Šé«˜ã„çŠ¶æ…‹ã§ã™ã€‚`, actions:['ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã®è¦‹ç›´ã—','ä½ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»åºƒå‘Šã‚»ãƒƒãƒˆã®åœæ­¢','LPã®CVRæ”¹å–„ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ç°¡ç•¥åŒ–ãƒ»CTAæœ€é©åŒ–ï¼‰','ç›®æ¨™CPAå…¥æœ­ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’æ¤œè¨']});
  }
  if (convRate < 0.3 && totalMeet > 0) {
    issues.push({p:2, cat:'è»¢æ›ç‡æ”¹å–„', title:`é¢è«‡â†’å¥‘ç´„è»¢æ›ç‡ãŒä½ã„ï¼ˆ${Math.round(convRate*100)}%ï¼‰`, detail:`ç›´è¿‘6ãƒ¶æœˆï¼šé¢è«‡${totalMeet}ä»¶â†’å¥‘ç´„${totalCont}ä»¶ã€‚ç›®æ¨™30%ã«å¯¾ã—é”æˆç‡${Math.round(convRate/0.3*100)}%ã€‚`, actions:['é¢è«‡å¾Œãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ»LINEï¼‰ã®å¼·åŒ–','å•†è«‡ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¦‹ç›´ã—','ä½“é¨“ã¸ã®èª˜å°ç‡ã‚’ä¸Šã’ã‚‹','é«˜ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ç‡æ‹…å½“è€…ã®ãƒã‚¦ãƒã‚¦å…±æœ‰']});
  }
  const recentCost = data.slice(-2).reduce((s,d)=>s+(d.cost||0),0);
  const prevCost   = data.slice(-4,-2).reduce((s,d)=>s+(d.cost||0),0);
  const recentCont = data.slice(-2).reduce((s,d)=>s+(d.cont||0),0);
  const prevCont   = data.slice(-4,-2).reduce((s,d)=>s+(d.cont||0),0);
  if (prevCost > 0 && recentCost > prevCost*1.1 && recentCont <= prevCont) {
    issues.push({p:2, cat:'äºˆç®—åŠ¹ç‡åŒ–', title:'ã‚³ã‚¹ãƒˆå¢—åŠ ã«CVæ•°ãŒè¿½ã„ã¤ã„ã¦ã„ãªã„', detail:`ç›´è¿‘2ãƒ¶æœˆã‚³ã‚¹ãƒˆãŒå‰æœŸæ¯”+${Math.round((recentCost/prevCost-1)*100)}%å¢—åŠ ã—ã¦ã„ã‚‹ãŒå¥‘ç´„æ•°ã¯æ¨ªã°ã„ã€‚`, actions:['ä½åŠ¹ç‡åª’ä½“ãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®äºˆç®—å‰Šæ¸›','é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ£ãƒãƒ«ã¸é›†ä¸­','A/Bãƒ†ã‚¹ãƒˆã§ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–æœ€é©åŒ–','æœˆæ¬¡äºˆç®—ã‚­ãƒ£ãƒƒãƒ—ã®è¦‹ç›´ã—']});
  }
  if (!issues.length) {
    issues.push({p:1, cat:'ç¶™ç¶šæ”¹å–„', title:'ç¾çŠ¶ç¶­æŒãƒ»ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã™', detail:'å¤§ããªèª²é¡Œã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å¼•ãç¶šããƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç¶­æŒãƒ»æ”¹å–„ã—ã¾ã™ã€‚', actions:['æ–°è¦ãƒãƒ£ãƒãƒ«ã®è©¦é¨“å°å…¥','ãƒªã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°ã®å¼·åŒ–','å£ã‚³ãƒŸãƒ»ç´¹ä»‹æ–½ç­–ã®æ¤œè¨','ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®æ¤œè¨']});
  }

  const colors = ['#dc2626','#f59e0b','#3b82f6','#10b981'];
  const bgColors = ['#fee2e2','#fef3c7','#dbeafe','#dcfce7'];
  const issuesEl = document.getElementById('biweekly-issues');
  issuesEl.innerHTML = issues.map((iss,i) => `
    <div class="card" style="border-left:4px solid ${colors[Math.min(i,3)]};margin-bottom:12px;">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
        <span style="background:${bgColors[Math.min(i,3)]};color:${colors[Math.min(i,3)]};padding:2px 10px;border-radius:12px;font-size:11px;font-weight:700;">å„ªå…ˆåº¦${iss.p}</span>
        <span class="badge badge-gray">${iss.cat}</span>
      </div>
      <div style="font-size:15px;font-weight:700;color:#111827;margin-bottom:6px;">${iss.title}</div>
      <div style="font-size:12.5px;color:#6b7280;margin-bottom:12px;">${iss.detail}</div>
      <div style="background:#f9fafb;border-radius:8px;padding:12px;">
        <div style="font-size:11.5px;font-weight:700;color:#374151;margin-bottom:8px;">æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
        ${iss.actions.map((a,j)=>`<div style="font-size:12.5px;color:#374151;padding:4px 0;display:flex;gap:8px;"><span style="color:${colors[Math.min(i,3)]};font-weight:700;">${j+1}.</span>${a}</div>`).join('')}
      </div>
    </div>`).join('');

  // Calendar
  const cal = [
    {day:'1ã€œ3æ—¥ç›®', phase:'åˆ†æ', tasks:['ãƒ‡ãƒ¼ã‚¿åé›†ãƒ»èª²é¡Œç¢ºèª','å‰å›æ–½ç­–ã®åŠ¹æœæ¸¬å®š','å„ªå…ˆé †ä½ã®æœ€çµ‚æ±ºå®š']},
    {day:'4ã€œ7æ—¥ç›®', phase:'å®Ÿè¡Œâ‘ ', tasks:['å„ªå…ˆåº¦1ã®æ–½ç­–å®Ÿæ–½','A/Bãƒ†ã‚¹ãƒˆè¨­å®š','ä½åŠ¹ç‡åºƒå‘Šã®åœæ­¢ãƒ»èª¿æ•´']},
    {day:'8ã€œ10æ—¥ç›®', phase:'ä¸­é–“ç¢ºèª', tasks:['æ–½ç­–ã®åˆæœŸåŠ¹æœç¢ºèª','å¿…è¦ã«å¿œã˜ã¦å¾®èª¿æ•´','ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—æ–½ç­–ã®æº–å‚™']},
    {day:'11ã€œ14æ—¥ç›®', phase:'å®Ÿè¡Œâ‘¡', tasks:['å„ªå…ˆåº¦2ã®æ–½ç­–å®Ÿæ–½','æ¬¡å›ãƒ‡ãƒ¼ã‚¿æ•´ç†','KPIé”æˆçŠ¶æ³ã®ç¢ºèª']},
  ];
  const phaseColors = {'åˆ†æ':'#7c3aed','å®Ÿè¡Œâ‘ ':'#2563eb','ä¸­é–“ç¢ºèª':'#f59e0b','å®Ÿè¡Œâ‘¡':'#10b981'};
  const tbody = document.getElementById('biweeklyCalBody');
  tbody.innerHTML = cal.map(c=>`
    <tr>
      <td style="text-align:left;font-weight:700;color:#374151;white-space:nowrap;">${c.day}</td>
      <td style="text-align:left;"><span style="background:${phaseColors[c.phase]}22;color:${phaseColors[c.phase]};padding:3px 10px;border-radius:12px;font-size:12px;font-weight:600;">${c.phase}</span></td>
      <td style="text-align:left;font-size:12.5px;color:#374151;">${c.tasks.join(' ï¼ ')}</td>
    </tr>`).join('');
}

// ========== RELOAD ==========
async function reloadData() {
  const ok = await loadFromGAS();
  if (ok) {
    const activePage = document.querySelector('.page.active');
    if (activePage) {
      const id = activePage.id.replace('page-', '');
      if (id === 'dashboard') { buildChips(activePeriod); render(); }
      if (id === 'cost') renderCost();
      if (id === 'cv') renderCv();
      if (id === 'report') renderReport();
    }
  }
}

// ========== INIT ==========
async function init() {
  const ok = await loadFromGAS();
  if (ok) {
    buildChips('2025');
    render();
  }
}
init();
</script>
<!-- Bottom Navigation (ã‚¹ãƒãƒ›ç”¨) -->
<nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <button class="bnav-item active" id="bnav-dashboard" onclick="showPage('dashboard', null, 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰')">
      <span class="bnav-icon">ğŸ“ˆ</span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    </button>
    <button class="bnav-item" id="bnav-cost" onclick="showPage('cost', null, 'ã‚³ã‚¹ãƒˆåˆ†æ')">
      <span class="bnav-icon">ğŸ’°</span>ã‚³ã‚¹ãƒˆ
    </button>
    <button class="bnav-item" id="bnav-cv" onclick="showPage('cv', null, 'CVè©³ç´°')">
      <span class="bnav-icon">ğŸ‘¥</span>CVè©³ç´°
    </button>
    <button class="bnav-item" id="bnav-report" onclick="showPage('report', null, 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ')">
      <span class="bnav-icon">ğŸ“…</span>ãƒ¬ãƒãƒ¼ãƒˆ
    </button>
    <button class="bnav-item" id="bnav-settings" onclick="showPage('settings', null, 'è¨­å®š')">
      <span class="bnav-icon">âš™ï¸</span>è¨­å®š
    </button>
  </div>
</nav>

<!-- Loading overlay -->
<div id="loading-banner">
  <div class="spinner"></div>
  <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
</div>
<!-- Error banner -->
<div id="error-banner"></div>
</body>
</html>
